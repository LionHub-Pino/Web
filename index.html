<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raw Viewer — Xem file dạng raw</title>

  <!-- Highlight.js (syntax highlighting) -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

  <style>
    :root {
      --bg: #0f1720;
      --panel: #0b1220;
      --muted: #9aa6b2;
      --accent: #6ee7b7;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
    }
    html,body { height:100%; margin:0; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial; background:#f4f6f8; color:#0b1220; }
    .wrap { max-width:1100px; margin:24px auto; padding:18px; background:#fff; border-radius:10px; box-shadow:0 6px 20px rgba(12,20,30,0.08); }
    h1 { margin:0 0 8px; font-size:20px; }
    p.lead { margin:0 0 16px; color:var(--muted); }
    .row { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:12px; }
    input[type="text"] { flex:1; padding:10px 12px; border:1px solid #e6e9ee; border-radius:8px; min-width:260px; }
    button { padding:10px 12px; border-radius:8px; border:0; background:#0f62fe; color:#fff; cursor:pointer; }
    button.alt { background:#111827; }
    .controls { display:flex; gap:8px; align-items:center; }
    .panel { border-radius:8px; padding:12px; background:#0b1220; color:#e6eef6; min-height:320px; overflow:auto; }
    pre { margin:0; font-family:var(--mono); font-size:13px; line-height:1.45; white-space:pre-wrap; word-break:break-word; }
    .dropzone { border:2px dashed #dbe6f0; padding:12px; border-radius:8px; color:#334155; background:#fbfdff; text-align:center; cursor:pointer; }
    .small { font-size:13px; color:var(--muted); }
    .toolbar { display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap; }
    .meta { display:flex; gap:8px; align-items:center; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Raw Viewer — Xem file dạng raw</h1>
    <p class="lead">Dán URL, kéo & thả file, hoặc dán nội dung để xem ở dạng raw và có syntax highlighting.</p>

    <div class="row">
      <input id="urlInput" type="text" placeholder="Dán URL tới file raw (ví dụ: https://raw.githubusercontent.com/user/repo/branch/file.lua)" />
      <div class="controls">
        <button id="fetchBtn">Tải từ URL</button>
        <button id="clearBtn" class="alt">Xóa</button>
      </div>
    </div>

    <div class="row">
      <div class="dropzone" id="dropzone">Kéo & thả file vào đây hoặc <button id="selectFileBtn" style="display:inline-block; margin-left:6px;">Chọn file</button></div>
      <input type="file" id="fileInput" style="display:none" />
    </div>

    <div class="row toolbar">
      <div class="meta">Kích thước: <span id="sizeText">—</span></div>
      <div class="meta">Loại: <span id="typeText">—</span></div>
      <div style="flex:1"></div>
      <button id="downloadBtn">Download raw</button>
      <button id="copyBtn">Copy raw</button>
      <button id="plainBtn" class="alt">Xem plain (không highlight)</button>
    </div>

    <div class="panel" id="panel">
      <pre><code id="codeBlock" class="hljs">Chưa có nội dung — dán URL, kéo & thả file, hoặc dán nội dung vào đây.</code></pre>
    </div>

    <div style="margin-top:10px;">
      <label class="small">Hoặc dán trực tiếp nội dung:</label>
      <textarea id="pasteArea" style="width:100%; min-height:120px; margin-top:6px; padding:10px; border-radius:8px; border:1px solid #e6e9ee; font-family:var(--mono)"></textarea>
      <div style="margin-top:8px; display:flex; gap:8px;">
        <button id="pasteBtn">Hiển thị nội dung dán</button>
        <button id="clearPaste" class="alt">Xóa ô dán</button>
      </div>
    </div>

    <p class="small" style="margin-top:12px; color:#475569">
      Ghi chú: một số URL có thể bị chặn bởi CORS — nếu fetch từ URL không thành công, bạn có thể host file trên <strong>raw.githubusercontent.com</strong>, hoặc dùng một proxy server nhỏ (nếu cần mình gửi ví dụ).
    </p>
  </div>

<script>
  // Elements
  const urlInput = document.getElementById('urlInput');
  const fetchBtn = document.getElementById('fetchBtn');
  const clearBtn = document.getElementById('clearBtn');
  const panel = document.getElementById('panel');
  const codeBlock = document.getElementById('codeBlock');
  const copyBtn = document.getElementById('copyBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const sizeText = document.getElementById('sizeText');
  const typeText = document.getElementById('typeText');
  const dropzone = document.getElementById('dropzone');
  const fileInput = document.getElementById('fileInput');
  const selectFileBtn = document.getElementById('selectFileBtn');
  const pasteArea = document.getElementById('pasteArea');
  const pasteBtn = document.getElementById('pasteBtn');
  const clearPaste = document.getElementById('clearPaste');
  const plainBtn = document.getElementById('plainBtn');

  let currentContent = '';
  let currentMime = '';
  let highlightOn = true;

  async function setContent(text, mime='text/plain') {
    currentContent = text || '';
    currentMime = mime || 'text/plain';
    sizeText.textContent = currentContent.length ? `${currentContent.length} bytes` : '—';
    typeText.textContent = currentMime;

    // Escape HTML, but allow highlight.js to work (we'll set textContent)
    codeBlock.textContent = currentContent || ' ';
    if (highlightOn) {
      // try auto-detect
      hljs.highlightElement(codeBlock);
    }
  }

  async function fetchUrl(url) {
    try {
      // show loading
      setContent('Đang tải...\n');
      const resp = await fetch(url, { mode: 'cors' });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const ct = resp.headers.get('content-type') || 'text/plain';
      const txt = await resp.text();
      await setContent(txt, ct);
    } catch (err) {
      await setContent(`Lỗi khi fetch URL:\n${err.message}`, 'text/plain');
      alert('Không thể tải file. Kiểm tra URL hoặc CORS (một số server chặn truy cập trực tiếp).');
    }
  }

  fetchBtn.addEventListener('click', () => {
    const url = urlInput.value.trim();
    if (!url) return alert('Hãy dán URL trước.');
    fetchUrl(url);
  });

  clearBtn.addEventListener('click', () => {
    urlInput.value = '';
    setContent('', '');
  });

  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(currentContent || '');
      alert('Đã copy vào clipboard.');
    } catch (e) {
      alert('Không thể copy (trình duyệt cần HTTPS).');
    }
  });

  downloadBtn.addEventListener('click', () => {
    const blob = new Blob([currentContent || ''], { type: currentMime || 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'file_raw.txt';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  // Drag & drop
  ;['dragenter','dragover'].forEach(ev => {
    dropzone.addEventListener(ev, (e) => { e.preventDefault(); dropzone.style.borderColor='#0f62fe'; });
  });
  ;['dragleave','drop'].forEach(ev => {
    dropzone.addEventListener(ev, (e) => { e.preventDefault(); dropzone.style.borderColor=''; });
  });

  dropzone.addEventListener('drop', async (e) => {
    const f = e.dataTransfer.files[0];
    if (!f) return;
    const txt = await f.text();
    await setContent(txt, f.type || 'text/plain');
  });

  selectFileBtn.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', async (ev) => {
    const f = ev.target.files[0];
    if (!f) return;
    const txt = await f.text();
    await setContent(txt, f.type || 'text/plain');
  });

  // Paste area
  pasteBtn.addEventListener('click', async () => {
    const t = pasteArea.value || '';
    await setContent(t, 'text/plain');
  });
  clearPaste.addEventListener('click', () => pasteArea.value = '');

  // Toggle plain/highlight
  plainBtn.addEventListener('click', () => {
    highlightOn = !highlightOn;
    plainBtn.textContent = highlightOn ? 'Xem plain (không highlight)' : 'Bật highlight';
    // re-render
    codeBlock.textContent = currentContent || ' ';
    if (highlightOn) hljs.highlightElement(codeBlock);
  });

  // init example
  setContent('', '');
</script>
</body>
</html>
